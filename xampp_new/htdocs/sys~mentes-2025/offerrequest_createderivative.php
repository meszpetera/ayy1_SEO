<?php  include_once("common.php");  if (isauth())  {    if (isset($_REQUEST['offerid']))    {//	  echo 'offerID: ' . $_REQUEST['offerid'] . '###uid: ' . $_REQUEST['uid'];      $mysql = get_connection();        $mysql->execute($sql['setutf']);            $stmt = $mysql->prepare($sql['offer_request:get_all_details']);      $stmt->bind_params($_REQUEST['offerid']);      if($stmt->execute())      {        $offerinfo = $stmt->fetch_all();        $offerinfo = $offerinfo[0];                $keys = '';        $values = '';                foreach ($offerinfo as $key => $value)        {          if ($key == 'offer_id')             continue;          else if ($key == 'offer_status')            $value = 1;          else if ($key == 'offer_user-id' && isset($_REQUEST['uid']))            $value = $_REQUEST['uid'];                    $keys .= '`' . $key . '`, ';          $values .= "'" . $value . "', ";        }                $keys = trim($keys, ', ');        $values = trim($values, ', ');                $stmt = $mysql->prepare($sql['offer_request:insert_with_all_details']);        $stmt->bind_params($keys, $values);        if($stmt->execute())        {          $stmt = $mysql->prepare('SELECT LAST_INSERT_ID()');          $stmt->execute();          $id = $stmt->fetch_all();          $id = $id[0]['LAST_INSERT_ID()'];                                  $trucks = explode(';', $offerinfo['offer_trucks']);                    //copy all the involved trucks          foreach ($trucks as $truck)          {                        $stmt = $mysql->prepare($sql['offer_request:get_all_truck_details']);            $stmt->bind_params($_REQUEST['offerid'], $truck);            if($stmt->execute())            {              $truckinfo = $stmt->fetch_all();              $truckinfo = $truckinfo[0];                            $truckinfo['offer_id'] = $id;			  if ($truckinfo['offer_truck_saxon-id'] != '')			  {			    $stmt2 = $mysql->prepare($sql['truck_getState']);                $stmt2->bind_params($truckinfo['offer_truck_id']);				$stmt2->execute();				                $truckState = $stmt2->fetch_all();                $truckState = $truckState[0]['truck_state'];								if ($truckState == 'S')					$truckinfo['offer_truck_saxon-id'] = '';			  }			                $keys = '';              $values = '';                            foreach ($truckinfo as $key => $value)              {                if ($key == 'offer_trucks_id')                   continue;                                $keys .= '`' . $key . '`, ';                $values .= "'" . $value . "', ";              }                            $keys = trim($keys, ', ');              $values = trim($values, ', ');                                                        $stmt = $mysql->prepare($sql['offer_request:insert_truck_with_all_details']);              $stmt->bind_params($keys, $values);              if($stmt->execute())              {                //print("truck " . $truck . " copied<br />");               }            }                       }          		            $stmt3 = $mysql->prepare($sql['offer_request:get_all_images']);          $stmt3->bind_params($_REQUEST['offerid']);          if($stmt3->execute())          {            $images = $stmt3->fetch_all();						foreach ($images as $image)			{				$stmt4 = $mysql->prepare($sql['offer_request:insert_image']);				$stmt4->bind_params($id, $image['offer_image_unique_id'], $image['offer_image_truck-id'], $image['offer_image_id'], $image['offer_image_filename'], $image['offer_image_enabled']);				$stmt4->execute();			}	      }		            recurse_copy("../img/trucks_copy/" . $_REQUEST['offerid'], "../img/trucks_copy/" . $id);          		  if (isset($_REQUEST['uid']))			print($id);		  else            redirect_in_site("?page=offer_requests_edit&lang=hun&tmp=2&request=" . $id);        }//        else//          print("You are no winner");      }    }  }    /*<?php  include_once("common.php");  if (isauth())  {    if (isset($_REQUEST['offerid']))    {	        $mysql = get_connection();        $mysql->execute($sql['setutf']);            $stmt = $mysql->prepare($sql['offer_request:get_all_details']);      $stmt->bind_params($_REQUEST['offerid']);      if($stmt->execute())      {        $offerinfo = $stmt->fetch_all();        $offerinfo = $offerinfo[0];                $keys = '';        $values = '';                foreach ($offerinfo as $key => $value)        {          if ($key == 'offer_id')             continue;          else if ($key == 'offer_status')            $value = 1;                    $keys .= '`' . $key . '`, ';          $values .= "'" . $value . "', ";        }                $keys = trim($keys, ', ');        $values = trim($values, ', ');                $stmt = $mysql->prepare($sql['offer_request:insert_with_all_details']);        $stmt->bind_params($keys, $values);        if($stmt->execute())        {          $stmt = $mysql->prepare('SELECT LAST_INSERT_ID()');          $stmt->execute();          $id = $stmt->fetch_all();          $id = $id[0]['LAST_INSERT_ID()'];                                  $trucks = explode(';', $offerinfo['offer_trucks']);                    //copy all the involved trucks          foreach ($trucks as $truck)          {                        $stmt = $mysql->prepare($sql['offer_request:get_all_truck_details']);            $stmt->bind_params($_REQUEST['offerid'], $truck);            if($stmt->execute())            {              $truckinfo = $stmt->fetch_all();              $truckinfo = $truckinfo[0];                            $truckinfo['offer_id'] = $id;			  if ($truckinfo['offer_truck_saxon-id'] != '')			  {			    $stmt2 = $mysql->prepare($sql['truck_getState']);                $stmt2->bind_params($truckinfo['offer_truck_id']);				$stmt2->execute();				                $truckState = $stmt2->fetch_all();                $truckState = $truckState[0]['truck_state'];								if ($truckState == 'S')					$truckinfo['offer_truck_saxon-id'] = '';			  }			                $keys = '';              $values = '';                            foreach ($truckinfo as $key => $value)              {                if ($key == 'offer_trucks_id')                   continue;                                $keys .= '`' . $key . '`, ';                $values .= "'" . $value . "', ";              }                            $keys = trim($keys, ', ');              $values = trim($values, ', ');                                                        $stmt = $mysql->prepare($sql['offer_request:insert_truck_with_all_details']);              $stmt->bind_params($keys, $values);              if($stmt->execute())              {                //print("truck " . $truck . " copied<br />");               }            }                       }          		            $stmt3 = $mysql->prepare($sql['offer_request:get_all_images']);          $stmt3->bind_params($_REQUEST['offerid']);          if($stmt3->execute())          {            $images = $stmt3->fetch_all();						foreach ($images as $image)			{				$stmt4 = $mysql->prepare($sql['offer_request:insert_image']);				$stmt4->bind_params($id, $image['offer_image_unique_id'], $image['offer_image_truck-id'], $image['offer_image_id'], $image['offer_image_filename'], $image['offer_image_enabled']);				$stmt4->execute();			}	      }		            recurse_copy("../img/trucks_copy/" . $_REQUEST['offerid'], "../img/trucks_copy/" . $id);                    redirect_in_site("?page=offer_requests_edit&lang=hun&tmp=3&request=" . $id);        }//        else//          print("You are no winner");      }    }  }?>        */  ?>