<?php /* Készítő: H.Tibor */ if(!$_ENV['SiteStart']) { header('HTTP/1.0 404 Not Found',false,404); header('Location: /'); exit(); }
function parse_ini_file_php($file,$process_sections=false,$rawdata=false){if(function_exists('parse_ini_file')){return parse_ini_file($file,$process_sections,$rawdata);}else{$process_sections=($process_sections!==true)?false:true;if(!$rawdata){$ini=file($file);}else{$file=str_replace("\r","",$file);$ini=explode("\n",$file);}if(count($ini)==0){return array();}$sections=array();$values=array();$result=array();$globals=array();$i=0;foreach($ini as $line){$line=trim($line);$line=str_replace("\t"," ",$line);if(!preg_match('/^[a-zA-Z0-9[]/',$line)){continue;}if($line{0}=='['){$tmp=explode(']',$line);$sections[]=trim(substr($tmp[0],1));$_sections=trim(substr($tmp[0],1));$i++;continue;}list($key,$value)=explode('=',$line,2);$key=trim($key);$value=trim($value);if(strstr($value,";")){$tmp=explode(';',$value);if(count($tmp)==2){if((($value{0}!='"')&&($value{0}!="'"))||preg_match('/^".*"\s*;/',$value)||preg_match('/^".*;[^"]*$/',$value)||preg_match("/^'.*'\s*;/",$value)||preg_match("/^'.*;[^']*$/",$value)){$value=$tmp[0];}}else{if($value{0}=='"'){$value=preg_replace('/^"(.*)".*/','$1',$value);}elseif($value{0}=="'"){$value=preg_replace("/^'(.*)'.*/",'$1',$value);}else{$value=$tmp[0];}}}$value=trim($value);$value=trim($value,"'\"");if($i==0){if(substr($line,-1,2)=='[]'){$globals[$key][]=$value;}else{$globals[$key]=$value;}}else{if($process_sections===true && isset($_sections)){if(substr($key,-2,2)=='[]'){$globals[$_sections][$key][]=$value;}else{$globals[$_sections][$key]=$value;}}else{if(substr($key,-2,2)=='[]'){$globals[$key][]=$value;}else{$globals[$key]=$value;}}}}for($j=0;$j<$i;$j++){if($process_sections===true){if(isset($sections[$j])&&isset($values[$j]))$result[$sections[$j]]=$values[$j];}else{if(isset($values[$j]))$result[]=$values[$j];}}return $result+$globals;}}
class Ini_Struct{private static $_result=array();public static function parse($filename,$process_sections=false,$section_name=null){$ini=parse_ini_file_php($filename,$process_sections);if($ini===false){return false;}self::$_result=array();if($process_sections===true){foreach($ini as $section=>$contents){self::_processSection($section,$contents);}}else{self::$_result=self::_processSectionContents($ini);}if($process_sections===true){if($section_name!==null){if(isset(self::$_result[$section_name])){return self::$_result[$section_name];}else{throw new Exception('Section '.$section_name.' not found in the ini file');}}}return self::$_result;}private static function _processSection($section,array $contents){if(stripos($section,':')===false){self::$_result[$section]=self::_processSectionContents($contents);}else{list($ext_target,$ext_source)=explode(':',$section);$ext_target=trim($ext_target);$ext_source=trim($ext_source);if(!isset(self::$_result[$ext_source])){throw new Exception('Unable to extend section '.$ext_source.', section not found');}self::$_result[$ext_target]=self::_processSectionContents($contents);self::$_result[$ext_target]=self::_arrayMergeRecursive(self::$_result[$ext_source],self::$_result[$ext_target]);}}private static function _processSectionContents(array $contents){$result=array();foreach($contents as $path=>$value){$process=self::_processContentEntry($path,$value);$result=self::_arrayMergeRecursive($result,$process);}return $result;}private static function _processContentEntry($path,$value){$pos=strpos($path,'.');if($pos===false){return array($path=>$value);}$key=substr($path,0,$pos);$path=substr($path,$pos+1);$result=array($key=>self::_processContentEntry($path,$value),);return $result;}private static function _arrayMergeRecursive($a,$b){if(is_array($a)&&is_array($b)){foreach($b as $key=>$value){if(isset($a[$key])){$a[$key]=self::_arrayMergeRecursive($a[$key],$value);}else{if($key===0){$a=array(0=>self::_arrayMergeRecursive($a,$value));}else{$a[$key]=$value;}}}}else{$a=$b;}return $a;}} ?>